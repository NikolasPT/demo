<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Tic Tac Toe</title>
  <style>
    :root {
      --bg: #0f1724;
      --x: #e11d48;
      --o: #06b6d4;
      --muted: #94a3b8;
      color-scheme: dark;
    }

    * {
      box-sizing: border-box;
    }

    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: linear-gradient(180deg, var(--bg), #071021 120%);
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
      color: #e6eef8;
    }

    .ttt__container {
      width: 100%;
      max-width: 720px;
      background: rgba(255,255,255,0.02);
      border-radius: 12px;
      padding: 20px 20px 28px;
      box-shadow: 0 6px 30px rgba(2,6,23,0.6);
      position: relative;
      overflow: visible;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      margin-bottom: 14px;
    }

    h1 { font-size: 20px; margin: 0; }

    .ttt__status { display: flex; flex-direction: column; align-items: flex-end; }
    .ttt__status-msg { font-weight: 600; }
    .ttt__status-sub { font-size: 13px; color: var(--muted); }

    .ttt__board {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin: 18px 0;
    }

    .ttt__cell {
      aspect-ratio: 1/1;
      padding: 0;
      border-radius: 10px;
      border: 2px solid rgba(255,255,255,0.04);
      background: linear-gradient(180deg, rgba(255,255,255,0.01), transparent);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: clamp(2rem, 10vw, 7rem);
      line-height: 1;
      font-weight: 700;
      color: var(--muted);
      cursor: pointer;
      user-select: none;
    }

    .ttt__cell:focus { outline: 3px solid rgba(124,58,237,0.18); }

    .ttt__cell--x { color: var(--x); }
    .ttt__cell--o { color: var(--o); }

    .ttt__controls {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .ttt__btn {
      background: transparent;
      border: 1px solid rgba(255,255,255,0.06);
      color: inherit;
      padding: 8px 12px;
      border-radius: 8px;
      cursor: pointer;
      transition: background 160ms ease, border-color 160ms ease, color 160ms ease;
    }

    .ttt__btn--primary {
      background: linear-gradient(90deg, #4f46e5, #7c3aed);
      border: none;
      color: white;
    }

    .ttt__score { display: flex; gap: 12px; align-items: center; color: var(--muted); font-size: 14px; }
    .ttt__score-item { display: inline-flex; gap: 6px; align-items: center; background: rgba(255,255,255,0.02); padding: 6px 8px; border-radius: 8px; }

    @media (max-width: 420px) {
      :root { --mark-vw-factor: 18vw; }
      .ttt__container { padding: 14px; }
    }

    /* Splash overlay styles (BEM: block = splash) */
    .splash__overlay {
      position: fixed;
      inset: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(2,6,23,0.6);
      backdrop-filter: blur(6px) saturate(1.05);
      opacity: 0;
      pointer-events: none;
      transition: opacity 260ms cubic-bezier(.2,.9,.3,1);
      z-index: 60;
    }

    .splash__overlay--visible {
      opacity: 1;
      pointer-events: auto;
    }

    .splash__card {
      width: min(560px, calc(100% - 48px));
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.02));
      border-radius: 14px;
      padding: 28px 28px;
      text-align: center;
      color: #fff;
      box-shadow: 0 10px 40px rgba(2,6,23,0.7), 0 0 40px rgba(124,58,237,0.08) inset;
      transform: scale(.92) translateY(6px);
      opacity: 0;
      animation: splashIn 420ms cubic-bezier(.2,.9,.3,1) forwards;
      display: flex;
      flex-direction: column;
      gap: 12px;
      align-items: center;
      justify-content: center;
      position: relative;
      z-index: 61;
    }

    .splash__icon {
      width: 84px;
      height: 84px;
      border-radius: 50%;
      display: grid;
      place-items: center;
      font-size: 36px;
      color: white;
      box-shadow: 0 6px 30px rgba(0,0,0,0.5);
      transform: translateY(-2px);
      position: relative; /* ensure pseudo-element positions relative to this */
      z-index: 1; /* stacking context for decorative glow */
    }

    .splash__message {
      font-size: 20px;
      font-weight: 700;
      letter-spacing: -0.02em;
    }

    .splash__sub {
      color: var(--muted);
      font-size: 14px;
    }

    /* Variants */
    .splash__card--success .splash__icon {
      background: linear-gradient(90deg, #10b981, #34d399);
      box-shadow: 0 8px 40px rgba(16,185,129,0.18);
    }

    .splash__card--lose .splash__icon {
      background: linear-gradient(90deg, #ef476f, #f43f5e);
      box-shadow: 0 8px 40px rgba(239,71,111,0.18);
    }

    .splash__card--draw .splash__icon {
      background: linear-gradient(90deg, #6b7280, #9ca3af);
      box-shadow: 0 8px 40px rgba(99,102,106,0.12);
    }

    /* Small decorative pulse */
    .splash__icon::after {
      content: '';
      position: absolute;
      left: 50%;
      top: 50%;
      width: 140px;
      height: 140px;
      border-radius: 50%;
      opacity: 0;
      transform: translate(-50%, -50%) scale(.7);
      pointer-events: none;
      z-index: 0; /* behind the icon but inside the card */
    }

    .splash__card--success .splash__icon::after {
      background: radial-gradient(circle, rgba(16,185,129,0.14), transparent 40%);
      animation: pulse 1600ms infinite;
    }

    .splash__card--lose .splash__icon::after {
      background: radial-gradient(circle, rgba(239,71,111,0.12), transparent 40%);
      animation: pulse 1600ms infinite;
    }

    .splash__card--draw .splash__icon::after {
      background: radial-gradient(circle, rgba(99,102,106,0.08), transparent 40%);
      animation: pulse 1600ms infinite;
    }

    @keyframes pulse {
      0% { opacity: 0.12; transform: translate(-50%, -50%) scale(.8); }
      50% { opacity: 0.04; transform: translate(-50%, -50%) scale(1); }
      100% { opacity: 0.12; transform: translate(-50%, -50%) scale(.8); }
    }

    @keyframes splashIn {
      0% { transform: scale(.88) translateY(10px); opacity: 0; }
      70% { transform: scale(1.02) translateY(-6px); opacity: 1; }
      100% { transform: scale(1) translateY(0); opacity: 1; }
    }

    /* Ensure overlay content is responsive */
    @media (max-width: 420px) {
      .splash__card { padding: 20px; }
      .splash__icon { width: 64px; height: 64px; font-size: 28px; }
      .splash__message { font-size: 18px; }
    }
  </style>
</head>
<body>
  <main class="ttt__container">
    <header>
      <h1>Tic Tac Toe</h1>
      <div class="ttt__status">
        <div id="statusMsg" class="ttt__status-msg" aria-live="polite">Player X's turn</div>
        <div class="ttt__status-sub">Click a cell or use keyboard (Tab + Enter/Space)</div>
      </div>
    </header>

    <section class="ttt__board" role="grid" aria-label="Tic Tac Toe board">
      <button class="ttt__cell" data-index="0" aria-label="Row 1, Column 1, empty" aria-pressed="false"></button>
      <button class="ttt__cell" data-index="1" aria-label="Row 1, Column 2, empty" aria-pressed="false"></button>
      <button class="ttt__cell" data-index="2" aria-label="Row 1, Column 3, empty" aria-pressed="false"></button>
      <button class="ttt__cell" data-index="3" aria-label="Row 2, Column 1, empty" aria-pressed="false"></button>
      <button class="ttt__cell" data-index="4" aria-label="Row 2, Column 2, empty" aria-pressed="false"></button>
      <button class="ttt__cell" data-index="5" aria-label="Row 2, Column 3, empty" aria-pressed="false"></button>
      <button class="ttt__cell" data-index="6" aria-label="Row 3, Column 1, empty" aria-pressed="false"></button>
      <button class="ttt__cell" data-index="7" aria-label="Row 3, Column 2, empty" aria-pressed="false"></button>
      <button class="ttt__cell" data-index="8" aria-label="Row 3, Column 3, empty" aria-pressed="false"></button>
    </section>

    <div class="ttt__controls">
      <div class="ttt__score">
        <span id="scoreX" class="ttt__score-item">X: 0</span>
        <span id="scoreO" class="ttt__score-item">O: 0</span>
        <span id="scoreD" class="ttt__score-item">Draws: 0</span>
      </div>

      <div>
        <button id="newGame" class="ttt__btn ttt__btn--primary">New Game</button>
        <button id="resetScores" class="ttt__btn" title="Reset scores">Reset Scores</button>
      </div>
    </div>
  </main>

  <!-- Splash overlay shown after each game result (BEM classes) -->
  <div id="splashOverlay" class="splash__overlay" aria-hidden="true" tabindex="-1">
    <div id="splashCard" class="splash__card" aria-hidden="true">
      <div id="splashIcon" class="splash__icon" aria-hidden="true">âœ“</div>
      <div id="splashMessage" class="splash__message" role="status" aria-live="polite">Congratulations, you won</div>
      <div id="splashSub" class="splash__sub">Starting next round...</div>
    </div>
  </div>

  <script>
    (function () {
      const cellEls = Array.from(document.querySelectorAll('.ttt__cell'));
      const statusEl = document.getElementById('statusMsg');
      const newGameBtn = document.getElementById('newGame');
      const resetScoresBtn = document.getElementById('resetScores');
      const scoreXEl = document.getElementById('scoreX');
      const scoreOEl = document.getElementById('scoreO');
      const scoreDEl = document.getElementById('scoreD');

      // Splash elements (IDs kept for JS referencing)
      const splashOverlay = document.getElementById('splashOverlay');
      const splashCard = document.getElementById('splashCard');
      const splashMessage = document.getElementById('splashMessage');
      const splashIcon = document.getElementById('splashIcon');

      const WINNING_COMBOS = [
        [0,1,2], [3,4,5], [6,7,8],
        [0,3,6], [1,4,7], [2,5,8],
        [0,4,8], [2,4,6]
      ];

      let board = Array(9).fill('');
      let currentPlayer = 'X';
      let isGameActive = true;
      const SCORE = { X: 0, O: 0, draws: 0 };
      let splashTimeout = null;

      function init() {
        cellEls.forEach(function (cell) {
          cell.addEventListener('click', onCellClick);
          cell.addEventListener('keydown', onCellKeyDown);
        });

        newGameBtn.addEventListener('click', resetGame);
        resetScoresBtn.addEventListener('click', resetScores);
        updateStatus("Player " + currentPlayer + "'s turn");
        render();
      }

      function onCellKeyDown(e) {
        if (e.key === 'Enter' || e.key === ' ') {
          e.preventDefault();
          e.target.click();
        }
      }

      function onCellClick(e) {
        const idx = Number(e.currentTarget.dataset.index);

        if (!isGameActive) {
          return;
        }

        if (board[idx]) {
          return;
        }

        placeMove(idx);
      }

      function placeMove(idx) {
        board[idx] = currentPlayer;
        updateCellUI(idx);

        if (checkWin()) {
          isGameActive = false;
          updateStatus('Player ' + currentPlayer + ' wins!');
          SCORE[currentPlayer] = SCORE[currentPlayer] + 1;
          updateScoreUI();

          // Determine message relative to human player (X is treated as the human)
          const isHumanWinner = currentPlayer === 'X';
          const message = isHumanWinner ? 'Congratulations, you won' : 'You lost, try again';
          const type = isHumanWinner ? 'success' : 'lose';
          showSplash(message, type);
          return;
        }

        if (checkDraw()) {
          isGameActive = false;
          updateStatus('Draw!');
          SCORE.draws = SCORE.draws + 1;
          updateScoreUI();
          showSplash('Draw', 'draw');
          return;
        }

        currentPlayer = currentPlayer === 'X' ? 'O' : 'X';
        updateStatus("Player " + currentPlayer + "'s turn");
      }

      function updateCellUI(idx) {
        const cell = cellEls[idx];
        const val = board[idx];
        cell.textContent = val;
        cell.classList.remove('ttt__cell--x','ttt__cell--o');

        if (val) {
          cell.classList.add('ttt__cell--' + val.toLowerCase());
        }

        const row = Math.floor(idx / 3) + 1;
        const col = (idx % 3) + 1;
        const label = 'Row ' + row + ', Column ' + col + ', ' + (board[idx] || 'empty');
        cell.setAttribute('aria-label', label);
        cell.setAttribute('aria-pressed', board[idx] ? 'true' : 'false');
      }

      function checkWin() {
        for (let i = 0; i < WINNING_COMBOS.length; i++) {
          const combo = WINNING_COMBOS[i];
          const a = combo[0];
          const b = combo[1];
          const c = combo[2];

          if (board[a] && board[a] === board[b] && board[a] === board[c]) {
            return true;
          }
        }

        return false;
      }

      function checkDraw() {
        return board.every(function (v) { return v; });
      }

      function updateStatus(text) {
        statusEl.textContent = text;
      }

      function resetGame() {
        board = Array(9).fill('');
        currentPlayer = 'X';
        isGameActive = true;

        cellEls.forEach(function (cell, i) {
          cell.textContent = '';
          cell.classList.remove('ttt__cell--x','ttt__cell--o');

          const r = Math.floor(i / 3) + 1;
          const c = (i % 3) + 1;

          cell.setAttribute('aria-label', 'Row ' + r + ', Column ' + c + ', empty');
          cell.setAttribute('aria-pressed', 'false');
        });

        updateStatus("Player " + currentPlayer + "'s turn");
        render();
      }

      function resetScores() {
        SCORE.X = 0;
        SCORE.O = 0;
        SCORE.draws = 0;
        updateScoreUI();
      }

      function updateScoreUI() {
        scoreXEl.textContent = 'X: ' + SCORE.X;
        scoreOEl.textContent = 'O: ' + SCORE.O;
        scoreDEl.textContent = 'Draws: ' + SCORE.draws;
      }

      function render() {
        cellEls.forEach(function (cell, i) {
          const val = board[i];
          cell.textContent = val;
          cell.classList.remove('ttt__cell--x','ttt__cell--o');

          if (val) {
            cell.classList.add('ttt__cell--' + val.toLowerCase());
          }
        });

        updateScoreUI();
      }

      // Splash control functions
      function showSplash(message, type) {
        if (splashTimeout) {
          clearTimeout(splashTimeout);
        }

        // set message and variant
        splashMessage.textContent = message;

        splashCard.classList.remove('splash__card--success', 'splash__card--lose', 'splash__card--draw');
        if (type === 'success') {
          splashCard.classList.add('splash__card--success');
        } else if (type === 'lose') {
          splashCard.classList.add('splash__card--lose');
        } else {
          splashCard.classList.add('splash__card--draw');
        }

        // set icon
        if (type === 'success') {
          splashIcon.textContent = 'ðŸŽ‰';
        } else if (type === 'lose') {
          splashIcon.textContent = 'ðŸ’”';
        } else {
          splashIcon.textContent = 'ðŸ¤';
        }

        // show overlay
        splashOverlay.setAttribute('aria-hidden', 'false');
+        splashCard.setAttribute('aria-hidden', 'false');
        splashOverlay.classList.add('splash__overlay--visible');

        // focus the overlay so screen reader users land on it
        try {
          splashOverlay.focus();
        } catch (err) {
          // ignore
        }

        // prevent interactions
        isGameActive = false;

        // hide after 2 seconds and start a new game
        splashTimeout = setTimeout(function () {
          hideSplash();
        }, 2000);
      }

      function hideSplash() {
        if (splashTimeout) {
          clearTimeout(splashTimeout);
          splashTimeout = null;
        }

        splashOverlay.classList.remove('splash__overlay--visible');
-        splashOverlay.setAttribute('aria-hidden', 'true');
+        splashOverlay.setAttribute('aria-hidden', 'true');
+        splashCard.setAttribute('aria-hidden', 'true');

        // small delay to allow opacity transition to finish before resetting game
        setTimeout(function () {
          // remove variant classes
          splashCard.classList.remove('splash__card--success', 'splash__card--lose', 'splash__card--draw');

          // reset the board for next round
          resetGame();

          // focus first cell for accessibility
          try {
            cellEls[0].focus();
          } catch (e) {
            // ignore
          }
        }, 260);
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', init);
      } else {
        init();
      }

    })();
  </script>
</body>
</html>
